---
title: 'GRFolres: A code for modified gravity simulations in strong gravity'
tags:
  - c++
  - MPI
  - Open MP
  - vector intrinsics
  - gravity
  - general relativity
  - numerical relativity
authors:
- name: Llibert Aresté Saló
  orcid: 
  affiliation: 1
- name: Sam E. Brady
  orcid: 0009-0000-5568-839X
  affiliation: 1
- name: Katy Clough
  orcid: 0000-0001-8841-1522
  affiliation: 1
- name: Daniela Doneva
  orcid: 
  affiliation: 3
- name: Tamara Evstafyeva
  orcid: 
  affiliation: 2
- name: Pau Figueras
  orcid: 
  affiliation: 1
- name: Tiago França
  orcid: 
  affiliation: 1
- name: Lorenzo Rossi
  orcid: 
  affiliation: 1
- name: Shunhui Yao
  orcid: 
  affiliation: 1
affiliations:
- name: School of Mathematical Sciences, Queen Mary University of London, Mile End Road, London E1 4NS, United Kingdom
  index: 1
- name: Department of Applied Mathematics and Theoretical Physics (DAMTP), University of Cambridge, Centre for Mathematical Sciences, Wilberforce Road, Cambridge CB3 0WA, United Kingdom
  index: 2
- name: Theoretical Astrophysics, Eberhard Karls University of T\"ubingen, T\"ubingen 72076, Germany
  index: 3
date: 21 Aug 2023
bibliography: paper.bib

---

# Summary

Gravitational waves (GWs) are generated by the mergers of dense, compact objects like black holes (BHs) and neutron stars (NSs). This provides an opportunity to study the strong field, highly dynamical regime of Einstein's theory of general relativity (GR) at higher curvature scales than previous observations [@LISA:2022kgy;@Perkins:2020tra;@Barausse:2020rsu;@Gnocchi:2019jzp;@Barack:2018yly;@Baker:2014zba]. It is possible that at such scales modifications to GR may start manifest. However, in order to detect such modifications, we need to understand what deviations could look like in theories beyond GR, in particular in the merger section of the signal in near equal mass binaries, which are key targets of the LIGO-Virgo-KAGRA network of detectors (and their future 3G successors). Such predictions necessitate the use of numerical relativity (NR), in which the (modified) equations of GR are evolved from an initial configuration several orbits before merger, through the merger period and the subsequent ``ringdown'', during which the gravitational wave signal can be extracted near the boundary. 

In particular, current waveforms are tested for consistency with GR by measuring parameterised deviations to the merger, inspiral and ringdown phases [@Maggio:2022hre;@Krishnendu:2021fga;@LIGOScientific:@2021sio;@Carson:2019kkh;@Cornish:2011ys]. However, if we obtain predictions for specific models we can check whether such parameterised deviations are well-motivated and consistent in alternative theories beyond GR [@LISA:2022kgy;@Okounkova:2022grv;@Johnson-McDaniel:2021yge;@Shiralilou:2021mfl;@Perkins:2021mhb;@Carson:2020ter;@Carson:2020cqb], and the potential to extract model parameters from data.

There are many ways to modify GR, one of the simplest being to add an additional scalar degree of freedom, which may result in so called ``hairy'' stationary black hole solutions; that is, black holes with a stable, non trivial configuration of the scalar field around them (see [@Doneva:2022ewd] for a review). An example of this is the class of Horndeski models [@Horndeski:1974wa]. Cubic Horndeski theories have been studied in [@Figueras:2020dzx,@Figueras:2021abd] and an implementation of this is included in GRFolres. Another more general example within the Horndeski models is the
four-derivative scalar-tensor theory (4$\partial ST$), which is the most general theory with up to fourth powers of the derivatives (but still second order equations of motion). Despite their relative simplicity, they have lacked well-posed (ie, numerically stable) formulations until relatively recently. 

An important breakthrough was made in 2020 by Kov\'acs and Reall, who showed that Horndeski theories are indeed well-posed in a modified version of the harmonic gauge [@Kovacs:2020pns;@Kovacs:2020ywu] - a particular coordinate system already used in NR. Subsequently, several specific theories within these classes were probed in their highly dynamical and fully non-linear regimes [@East:2020hgw;@East:2021bqk;@East:2022rqi;@Corman:2022xqg]. The extension of the results of [@Kovacs:2020pns;@Kovacs:2020ywu] to the alternative ``singularity avoiding'' coordinates in [@AresteSalo:2022hua;@AresteSalo:2023mmd;@Doneva:2023oww] offers an alternative gauge in which to probe questions of hyperbolicity, and may offer stability advantages for certain cases. Numerical work on these theories is still in the early stages of development and many physical questions, as well as technical implementation details, require further study. 

The goal of GRFolres is to meet this need for further research, and to provide a model code to help others develop and test their own implementations. The code is based on the publicly available NR code GRChombo [@Clough:2015sqa;@Andrade:2020dgc], which itself uses the open source Chombo framework [@Adams:2015kgr] for solving PDEs. 

In the following sections we discuss the key features, motivations and applications of the code.

# Key features of GRFolres

GRFolres inherits many of the features of GRChombo and Chombo. The key features are:
- Modified gravity theories: The currently available theories in the code are 4$\partial$ST and cubic Horndeski. The code is templated over the theory (in the same way that GRChombo is templated over a matter class) so that it can easily be changed without major code modification.
- Accuracy: The fields are evolved with a 4th order Runge-Kutta time integration and their derivatives calculated with the same finite difference stencils used in GRChombo (4th and 6th order are currently available).
- Boundary Conditions: GRFolres inherits all the available boundary conditions in GRChombo, namely, extrapolating, Sommerfeld (radiative), reflective and periodic. 
- Initial Conditions: The current examples use solutions that approximately or trivially solve the modified energy and momentum constraints of the theory. An elliptic solver for more general configurations is under development, using a modified CTTK formalism [@Aurrekoetxea:2022mpw;@Brady_in_prep].
- Diagnostics:  \katy{May need to amend this.} GRFolres has routines for verifying the weak field condition on the theory, the effective determinant of the physical degrees of freedom and the energy density associated with the Gauss Bonnet term, as discussed in [@AresteSalo:2022hua;@AresteSalo:2023mmd;@Doneva:2023oww].
- C++ class structure: Following the structure of GRChombo, the GRFolres code is also written in C++ and uses object oriented programming (OOP) and templating.
- Parallelism: GRChombo uses hybrid OpenMP/MPI parallelism with explicit vectorisation of the evolution equations via intrinsics, and is AVX-512 compliant.
- Adaptive Mesh Refinement: The code inherits the flexible AMR grid structure of Chombo, which provides Berger-Oliger style [@Berger:1984zza] AMR with block-structured Berger-Rigoutsos grid generation [@Berger:1991]. Depending on the problem, the user may specify the refinement to be triggered by the additional gravitational degrees of freedom, or by the usual GR ones.

# Statement of Need

As far as we are aware there is currently no other publicly available code that implements the 4$\partial$ST theory of modified gravity or the cubic Horndeski theory in 3+1D numerical relativity. 

There is at least one private code, based on the PAMR/AMRD and HAD [@East:2011aa;@Neilsen:2007ua] infrastructure, that was used in the first works to successfully implement the modified general harmonic gauge for 4$\partial$ST [@East:2020hgw;@East:2021bqk;@East:2022rqi;@Corman:2022xqg]. 
Since this code uses a Generalised Harmonic Coordinates (GHC) formulation, it necessitates excision of the interior of black holes, which can be difficult to implement in practise. As a consequence,  many groups in the numerical relativity community have opted to use singularity avoiding coordinates such as the BSSN [@Nakamura:1987zz;@Shibata:1995we;@Baumgarte:1998te], Z4C [@Bona:2003fj;@Bernuzzi:2009ex] or CCZ4 [@Alic:2011gg;@Alic:2013xsa] formulations in the puncture gauge [@Campanelli:2005dd;@Baker:2005vv], which do not require the excision of the interior of black holes from the computational domain. 
In GRFolres, we use the results of [@AresteSalo:2022hua;@AresteSalo:2023mmd;@Doneva:2023oww] to extend the well posed formulations of modified gravity to singularity avoiding coordinates. This provides an alternative gauge to the modified GHC one used by other groups. Not only does this provide a valuable comparison to their work, but it may offer advantages in stability for certain scenarios, for example, to treat difficulties encountered in unequal mass mergers, as discussed in [@Corman:2022xqg].

There are also a number of 3+1D codes that implement the equations for the additional scalar degree of freedom in Einstein scalar Gauss Bonnet without backreaction onto the metric tensor, including one implementation using GRChombo [@Evstafyeva:2022rve], which we have integrated into GRFolres to enable comparison between the methods. In particular, Canuda (\url{https://bitbucket.org/canuda}) [@Witek:2018dmd] which uses the Einstein Toolkit (\url{http://einsteintoolkit.org/}), with its related Cactus (\url{http://cactuscode.org}) [@Loffler:2011ay;@Schnetter:2003rb] and Kranc (\url{http://kranccode.org}) [@Husa:2004ip] infrastructure, was used in [@Richards:2023xsr;@Elley:2022ept;@R:2022tqa;@Silva:2020omi;@Witek:2018dmd]. Another implementation is based on The Spectral Einstein Code or SpEC (\url{http://www. black-holes.org/SpEC.html}) [@Pfeiffer:2002wt], as used in [@Okounkova:2020rqw].
Whilst order-reduced methods like those in [@Richards:2023xsr;@R:2022tqa;@Okounkova:2022grv;@Elley:2022ept;@Doneva:2022byd;@Okounkova:2020rqw;@Silva:2020omi;@Okounkova:2019zjf;@Okounkova:2019dfo;@Witek:2018dmd;@Evstafyeva:2022rve] 
provide an estimate of the scalar dynamics and associated energy losses, they may miss information about the fully non-linear impact on the metric and suffer from the accumulation of secular errors over long inspirals.

In spherical symmetry several codes have been developed that implement Einstein scalar Gauss Bonnet (a subset of the $4\partial ST$ theory that we include as an example in GRFolres). In particular, using the NRPy framework (\url{http://astro.phys.wvu.edu/bhathome}) [@Ruchlin:2017com] in [@Doneva:2022byd}], and the private code of Ripley \& Pretorius in [@R:2022hlf;@Ripley:2020vpk;@Ripley:2019irj;@Ripley:2019hxt;@Ripley:2019aqj]. Spherical codes provide a useful testing ground in which coordinate ambiguities can be avoided [@R:2022hlf], but lack the generality required to study objects with angular momentum, or binary mergers.

# Key research projects using GRChombo

So far the code has been used to study a range of fundamental physics problems:
- In the work [@AresteSalo:2022hua], the code was developed and tested, with waveforms for shift symmetric theories of Einstein scalar Gauss bonnet gravity produced for equal mass binaries, as illustrated in Fig. \ref{fig:waveform}.
![Modified gravity waveforms in 4$\partial$ST with a shift symmetric coupling. Taken from [@AresteSalo:2022hua].](Figures/all_waves.png){width=45%} 
        \label{fig:waveform}

    
- In the work [@AresteSalo:2023mmd], the studies were extended to binary mergers in theories with spin induced scalarisation. The clouds formed are dumbell like in shape, as illustrated in Fig. \ref{fig:spin}.
![The time evolution of the density of the scalar cloud that develops in Einstein scalar Gauss Bonnet gravity with an exponential coupling, resulting in spin induced scalarisation. Taken from [@AresteSalo:2023mmd].](Figures/rhophi.png){width=45%} 
        \label{fig:spin}

- In the work [@Doneva:2023oww], the dependence of the conditions for hyperbolicity and weak coupling were studied for spin induced scalarisation, and the critical thresholds found for a number of cases, as illustrated in Fig. \ref{fig:hyperbolicity}.
![The time evolution of determinant of the effective metric in a case of spin induced scalarisation. When the determinant is negative (in black), this indicates that that theory has become ill posed. Taken from [@Doneva:2023oww].](Figures/discriminant_beta200.png){width=45%}
        \label{fig:hyperbolicity}



# Acknowledgements

We thank the entire \texttt{GRChombo} \footnote{\texttt{www.grchombo.org}} collaboration for their support and code development work. PF and KC are supported by an STFC Research Grant ST/X000931/1 (Astronomy at Queen Mary 2023-2026). PF is supported by a Royal Society University Research Fellowship  No. URF\textbackslash R\textbackslash 201026, and No. RF\textbackslash ERE\textbackslash 210291. KC is supported by an STFC Ernest Rutherford fellowship, project reference ST/V003240/1. LAS is supported by a QMUL Ph.D. scholarship.
DD acknowledges financial support via an Emmy Noether Research Group funded by the German Research Foundation (DFG) under grant no. DO 1771/1-1. 
LR is supported by a Royal Society Renewal Grant, No. URF\textbackslash R\textbackslash 201026, and a Research Expenses Enhancement Award, No. RF\textbackslash ERE\textbackslash 210291.

Development of the code used in this work utilised the ARCHER2 UK National Supercomputing Service\footnote{\texttt{https://www.archer2.ac.uk}} under the EPSRC HPC project no. E775, the CSD3 cluster in Cambridge under Projects No. DP128. The Cambridge Service for Data Driven Discovery (CSD3), partially operated by the University of Cambridge Research Computing on behalf of the STFC DiRAC HPC Facility. 
The DiRAC component of CSD3 is funded by BEIS capital via STFC capital Grants No. ST/P002307/1 and No. ST/ R002452/1 and STFC operations Grant No. ST/R00689X/1. DiRAC is part of the National e-Infrastructure\footnote{\texttt{www.dirac.ac.uk}}. 
Calculations were also performed using the Sulis Tier 2 HPC platform hosted by the Scientific Computing Research Technology Platform at the University of Warwick. Sulis is funded by EPSRC Grant EP/T022108/1 and the HPC Midlands+ consortium. This research has also utilised Queen Mary's Apocrita HPC facility, supported by QMUL Research-IT.
This study is in part financed by the European Union-NextGenerationEU, through the National Recovery and Resilience Plan of the Republic of Bulgaria, project No. BG-RRP-2.004-0008-C01. We acknowledge Discoverer PetaSC and EuroHPC JU for awarding this project access to Discoverer supercomputer resources. 

# References

